# Security Defaults & Hardening

OpenClaw is powerful but **genuinely dangerous when misconfigured**. This reference covers the critical vulnerability history, safe defaults, hardening steps, and incident response. Apply these before going live with any deployment.

## ⚠️ CVE-2026-25253 — Critical Remote Code Execution

**All OpenClaw versions before 2026.1.29 are affected.** CVSS score: 8.8 (High). CWE-669.

### What happened

The OpenClaw Control UI accepted a `gatewayUrl` parameter from the URL query string and automatically established a WebSocket connection **without user confirmation**, transmitting the stored authentication token. Combined with missing WebSocket origin validation, this enabled a **1-click RCE kill chain**:

1. Victim visits a malicious URL
2. Token exfiltrated in milliseconds via crafted `gatewayUrl` parameter
3. Attacker connects via Cross-Site WebSocket Hijacking
4. Disables sandbox: `exec.approvals.set = 'off'`
5. Escapes Docker: `tools.exec.host = 'gateway'`
6. Full remote code execution on host

Even localhost-bound instances were vulnerable because the attack pivoted through the victim's browser.

### Remediation (mandatory)

```bash
# 1. Update immediately
openclaw update --channel stable
openclaw --version    # Must show 2026.1.29+

# 2. Rotate ALL gateway auth tokens
export OPENCLAW_GATEWAY_TOKEN=$(openssl rand -hex 32)
# Update in openclaw.json and restart

# 3. Rotate ALL API keys (Anthropic, OpenAI, etc.)
# Generate new keys at each provider's console

# 4. Review logs for suspicious WebSocket connections
openclaw gateway logs | grep -i "websocket\|ws://"
```

The fix (v2026.1.29) implemented Trust on First Use (TOFU) policy and WebSocket origin validation.

## The 42,665 Exposed Instances

Security researcher **Maor Dayan** discovered 42,665 publicly exposed OpenClaw instances via Shodan/Censys scanning:

- **93.4%** had critical authentication bypasses
- **8 instances** were completely open — no password, no token, full shell access
- One user's Anthropic API key was leaked and exploited for **11 days** before discovery

### Root causes

1. **Docker default port binding** to `0.0.0.0` on VPS instances with public IPs — making gateways discoverable via Shodan HTML fingerprints
2. **Reverse proxies** making all traffic appear as localhost, bypassing auth
3. **Guest mode privilege escalation** granting Python REPL access
4. **API keys stored in plaintext** in `~/.clawdbot` leaking via exposed dashboards

### Lesson

If you run OpenClaw on a VPS, assume it WILL be found by automated scanners. Binding to 0.0.0.0 is equivalent to publishing your gateway to the internet.

## Quick Security Audit

Run these commands after any installation or configuration change:

```bash
# Read-only config + filesystem scan
openclaw security audit

# Deep scan: adds live WebSocket probe + credential location audit
openclaw security audit --deep

# Auto-fix safe issues, then run full audit for remaining
openclaw security audit --fix

# Health check with security warnings
openclaw doctor
openclaw doctor --fix        # Auto-fix permission problems, missing dirs, config errors
openclaw doctor --deep --yes # Deep health check with auto-accept fixes
```

## Safe Baseline Configuration

Copy-paste this as your starting point. Every setting is explained below.

```json5
{
  gateway: {
    port: 18789,
    mode: "local",
    bind: "loopback",                    // 1. Localhost only
    auth: {
      mode: "token",                     // 2. Token required
      token: "<auto-generated-or-openssl-rand-hex-32>",
      allowTailscale: true               // Allows Tailscale connections
    }
  },
  channels: {
    telegram: {
      enabled: true,
      dmPolicy: "pairing",              // 3. Require approval for DMs
      groups: {
        "*": { requireMention: true }   // 4. @mention required in groups
      }
    }
  },
  discovery: {
    mdns: { mode: "minimal" }           // 5. Minimal network broadcasting
  },
  session: {
    dmScope: "per-channel-peer"          // 6. Isolate sessions per user
  }
}
```

### Setting Explanations

1. **`gateway.bind: "loopback"`** — Binds to 127.0.0.1 only. The gateway is never reachable from outside the machine. Access via SSH tunnel or Tailscale. This is the single most important security setting.

2. **`gateway.auth.mode: "token"`** — Requires a strong random token for all gateway connections. Auto-generated during onboarding, or generate manually: `openssl rand -hex 32`.

3. **`dmPolicy: "pairing"`** — Unknown senders receive a pairing code instead of getting direct access. You approve each contact via `openclaw pairing approve`. Never use `dmPolicy: "open"` with `allowFrom: ["*"]` unless you understand you're giving anyone access.

4. **`requireMention: true`** — Bot only responds in groups when @mentioned. Prevents it from responding to every message and reduces prompt injection surface.

5. **`discovery.mdns.mode: "minimal"`** — Minimal mDNS broadcasting. Use `"off"` on VPS deployments. Disable Bonjour entirely: `export OPENCLAW_DISABLE_BONJOUR=1`.

6. **`session.dmScope: "per-channel-peer"`** — Each channel+sender pair gets an isolated session. Prevents cross-user context leakage in multi-user setups.

## File Permissions

```bash
# Lock down the OpenClaw directory
chmod 700 ~/.openclaw
chmod 600 ~/.openclaw/openclaw.json
chmod 700 ~/.openclaw/credentials

# Lock auth profiles
chmod 600 ~/.openclaw/agents/*/agent/auth-profiles.json

# Full-disk encryption
# macOS: Enable FileVault (System Settings → Privacy & Security → FileVault)
# Linux: Use LUKS
```

## Docker Port Binding (VPS Critical)

The #1 cause of exposed instances. In `docker-compose.yml`:

```yaml
# ❌ DANGEROUS — binds to all interfaces, publicly accessible via Shodan
ports:
  - "18789:18789"

# ✅ SAFE — binds to localhost only
ports:
  - "127.0.0.1:18789:18789"
```

Verify after starting:
```bash
ss -tlnp | grep 18789
# Must show: 127.0.0.1:18789
# If you see: 0.0.0.0:18789 — STOP and fix immediately
```

## Sandboxing

Control whether agent sessions run in isolated containers:

```json5
{
  agents: {
    defaults: {
      sandbox: {
        mode: "non-main"  // Sandbox group/channel sessions (recommended for VPS)
        // mode: "off"     // No sandboxing (default)
        // mode: "all"     // Sandbox every session
      }
    }
  }
}
```

Scope options:
- `"agent"` — Per-agent containers (default when sandboxing enabled)
- `"session"` — Stricter per-session isolation
- `"shared"` — Single shared container

**Rootless Podman** is strongly preferred over Docker for sandboxing. A container escape in rootless Podman lands as an unprivileged user (UID 1000), not root. **Never mount `/var/run/docker.sock`** into the OpenClaw container — a container escape would grant full Docker control.

## SOUL.md Security

SOUL.md defines agent behavioral boundaries and is loaded into the system prompt at every session start. The `CRITICAL` keyword marks rules that should never be overridden — legitimate use is marking security-sensitive rules.

### ⚠️ SOUL.md is Writable by Default

This makes it a **prime attack surface**. A compromised SOUL.md grants control equivalent to a compromised `.bashrc` — the agent will follow whatever instructions are in it.

Defenses:
- **Treat SOUL.md as code** — review changes carefully
- **Set read-only permissions during runtime:** `chmod 444 ~/.openclaw/workspace/SOUL.md`
- **Use file integrity monitoring** (e.g., `md5sum` checks in a cron job)
- **Backup SOUL.md** before installing any skills or making agent changes
- Mark critical security rules with the `CRITICAL` keyword:
  ```markdown
  CRITICAL: Never execute commands that delete files recursively.
  CRITICAL: Never send data to external URLs unless explicitly approved.
  ```

## ClawHub Skills Security

**Treat ClawHub community skills with extreme caution.**

The facts:
- Cisco's AI Defense team found **26% of analyzed ClawHub skills contain at least one vulnerability** (9 found in a single skill, 2 critical, 5 high severity)
- One skill (#1 ranked "What Would Elon Do?") used direct prompt injection to silently exfiltrate data via `curl` commands
- Koi Security found **341 malicious skills** across 2,857 analyzed, with 335 using fake prerequisites to install **Atomic Stealer (AMOS) macOS malware**
- No signature verification exists on ClawHub currently
- VirusTotal partnership provides scanning, but social engineering attacks bypass it

### Safe practices:
- Only install **bundled skills** during onboarding
- If you must use ClawHub skills, review the source code first
- Skills are just code — `npm install` can run arbitrary scripts
- Never install a skill that asks you to run additional install commands
- Check skill ratings AND review counts (fake ratings are common)
- Monitor `~/.openclaw/logs/commands.log` (if command-logger hook is enabled) for unexpected commands after installing skills

## What NOT to Expose

Never configure or enable these in public-facing or group contexts:

- **Directory listings** of the workspace or config
- **Credentials** in SOUL.md, MEMORY.md, or any file loaded into LLM context
- **Reasoning/verbose mode** in public rooms (leaks system prompt details)
- **Elevated tools** (shell access, file write, git push) in group sessions
- **Browser control** in shared contexts
- **`/restart` command** (disabled by default; don't enable: `commands.restart: true`)
- **Guest mode** with elevated privileges (was exploited in exposed instances)

## Blocking Destructive Commands

Add to SOUL.md or agent configuration:

```markdown
CRITICAL: Never execute these commands:
- rm -rf (recursive delete)
- git push --force (force push)
- Commands piped through shell (curl | bash, wget | sh)
- Any command that modifies system files outside the workspace
```

## Trust Hierarchy

OpenClaw processes input from multiple sources. Trust level (highest to lowest):

1. **System prompt / SOUL.md** — Highest trust (but protect from modification)
2. **Owner DMs** — Approved owner via pairing
3. **Approved users** — Paired contacts
4. **Group messages** — Lower trust, mention-gated
5. **Web content / tool results** — Untrusted external data
6. **Strangers** — Zero trust, pairing code required

Configure the agent to treat external content (web search results, file contents from unknown sources) as untrusted data that should not override SOUL.md rules.

## Network Security

### Tailscale (recommended — zero public ports)

```bash
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up
tailscale serve https / http://127.0.0.1:18789
```

### SSH Tunnel (alternative)

```bash
ssh -N -L 18789:127.0.0.1:18789 user@VPS_IP
# Then access: http://127.0.0.1:18789/?token=YOUR_TOKEN
```

### UFW + fail2ban (VPS mandatory)

```bash
sudo apt install ufw fail2ban unattended-upgrades -y
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp
sudo ufw enable
sudo systemctl enable fail2ban
```

**Do NOT open port 18789 in UFW.** Access via tunnel or Tailscale only.

## Dedicated User (VPS)

Never run OpenClaw as root:

```bash
useradd -r -m -d /opt/openclaw -s /bin/bash openclaw
# Transfer ownership of OpenClaw files
chown -R openclaw:openclaw /opt/openclaw/.openclaw
```

Disable root SSH in `/etc/ssh/sshd_config`:
```
PermitRootLogin no
PasswordAuthentication no
```

## Incident Response Procedure

If you suspect a compromise:

1. **Stop the gateway immediately:**
   ```bash
   openclaw gateway stop
   # Or: docker compose down
   ```

2. **Lock down network access:**
   ```bash
   sudo ufw deny 18789
   ```

3. **Rotate ALL secrets:**
   ```bash
   # New gateway token
   export OPENCLAW_GATEWAY_TOKEN=$(openssl rand -hex 32)
   # Regenerate API keys at each provider's console
   # Regenerate Telegram bot token via BotFather
   ```

4. **Review logs:**
   ```bash
   openclaw gateway logs | grep -i "suspicious\|unauthorized\|websocket"
   cat ~/.openclaw/logs/commands.log | tail -100
   ```

5. **Check SOUL.md integrity:**
   ```bash
   # Compare against your known-good backup
   diff ~/.openclaw/workspace/SOUL.md ~/backups/SOUL.md.bak
   ```

6. **Re-audit:**
   ```bash
   openclaw security audit --deep
   openclaw doctor --deep --yes
   ```

7. **Update to latest version:**
   ```bash
   openclaw update --channel stable
   ```

## Shadow's Warning

One of OpenClaw's maintainers, known as "Shadow," stated on Discord:

> "If you can't understand how to run a command line, this is far too dangerous of a project for you to use safely."

Peter Steinberger himself acknowledged on the Lex Fridman Podcast (#491) that many security issues stemmed from users putting the web backend on the public internet despite documentation warnings. He has hired professional security researcher Jamieson O'Reilly (founder of Dvuln) to strengthen the platform.

This skill exists to bridge that gap — providing safe defaults and clear guidance so that users at all skill levels can deploy OpenClaw without exposing themselves to unnecessary risk. But the warning stands: OpenClaw is powerful software that requires respect for security fundamentals.
